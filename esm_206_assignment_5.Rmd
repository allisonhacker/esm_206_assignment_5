---
title: "Effect of forest condition on Pacific giant salamander populations"
author: "Allison Hacker and Cameryn Brock"
date: "11/20/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# Attach packages
library(tidyverse)
library(janitor)
library(kableExtra)
library(effsize)

# Read in data
salamanders <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  filter(species == "DITE")
```

### Introduction

The Pacific giant salamander (*Dicamptodon tenebrosus*) is the largest amphibian species in the Pacific Northwest (Figure 1). Although it is not a threatened species, it relies on cold, clean stream habitat for food and reproduction ("Pacific Giant Salamander" n.d.). Logging threatens this habitat by removing canopy cover and increasing soil erosion, which result in warmer water and increased suspended sediment. Due to their sensitivity to such environmental changes, amphibian populations can be used as an indicator of riparian ecosystem health (Welsh and Ollivier, 1998). Pacific giant salamander populations have been monitored in both clear cut and intact old growth forest in Oregon State's H.J. Andrews Experimental Forest since 1993. In this study, we compare salamander abundance and weight in various channel types to explore the effect of logging on salamander populations.

![**Figure 1**. Pacific giant salamander (*Dicamptodon tenebrosus*). Credit: [Jeffery Marsten *Wikimedia*](https://commons.wikimedia.org/wiki/File:Dicamptodon_tenebrosus_2.JPG)](pacific_giant_salamander.jpg)

### Data and Methods
### Results

#### 1. Salamander Abundance in forested versus logged sections of Mack Creek
```{r}
# Part A : Annual salamander counts by year

salamander_count <- salamanders %>% 
  group_by(section, year) %>% 
  summarize(n = n())

ggplot(salamander_count, aes(x = year, y = n))+
  geom_line(aes(color = section))+
  geom_point(aes(color = section))+
  theme_minimal()+
  labs(x = "Year", y = "Number of Salamanders")+
  scale_color_manual(
    name = "Creek Section", 
    labels = c("Clear Cut", "Old Growth"),
    values = c("burlywood3", "darkgreen")
    )+
  scale_x_continuous(breaks = seq(1993,2017,3), expand = c(0.02,0))+
  scale_y_continuous(limits = c(0,400), breaks = seq(0,400,100), expand = c(0,0))+
  theme(panel.grid.minor = element_blank())

```

**Figure 1.** Pacific giant salamander abundance (1993-2017). The annual number of observations from an old growth coniferous forest (green) and a clear cut forest (brown) are shown for all years that observations were recorded.

Trends in salamander abundance between 1993 and 2017 were similar for both sections of Mack Creek. Until 2014, abundance of Pacific giant salamanders was greater in rach of Mack Creek in an old growth forest than in the section that flowed through a clear cut forest. From 2015 to 2017, salamander abundance was slightly higher in the clear cut reach than the forested reach.

#### 2. Salamander abundance based on channel classification in 2017

**Table 1.** Pacific giant salamander abundance for different channel classifications in 2017. Number of observations and proportions are shown for clear cut and old growth sections of Mack Creek.
```{r}
# Part B: 2017 salamander counts by channel classification

channel_class <- salamanders %>% 
  filter(year == 2017,
         unittype != "IP") %>% 
  mutate(unittype = case_when(unittype == "C" ~ "Cascade",
                              unittype == "P" ~ "Pool",
                              unittype == "SC" ~ "Side Channel")) %>% 
  group_by(section, unittype) %>% 
  summarize(n = n())
  
 channel_class_wide <- channel_class %>% 
   pivot_wider(names_from = section, values_from = n)

channel_class_props <- channel_class_wide %>% 
  adorn_percentages(denominator = "col") %>% 
  adorn_pct_formatting(digits = 1) %>% 
  adorn_ns(position = "front")

kable(channel_class_props, 
      align = "c",
      col.names = c("Channel Classification",
                    "Clear Cut",
                    "Old Growth")
      ) %>% 
  kable_styling(bootstrap_options = c("hover"))
```


```{r}
# Part C: Chi-squared test for effect of forest condition on preferred channel classification
channel_counts <- channel_class_wide %>% 
  select(-unittype)

channel_chi <- chisq.test(channel_counts)
#channel_chi
```

Salamander abundance differed among the three channel classifications. In both clear cut and old growth sections, cascades had the greatest number of salamanders (247 (67.1%)) and 201 (62.8%)), followed by side channels (90 (24.5%)) and 74 (23.1%)). Pools had the fewest number of salamanders for clear cut (31 (8.4%)) and old growth (45 (14.1%)) creek sections.

However, there is no significant effect of forest condition (clear cut and old growth) and the channel classification (cascade, pool, or side channel) where salamanders are found ($\chi^2$ (`r channel_chi$parameter`) = `r round(channel_chi$statistic, 2)`, p = `r round(channel_chi$p.value,3)`).

#### 3. Salamander weight based in clear cut and old growth forest in 2017

```{r}

cc_weight <- salamanders %>% 
  filter(year == 2017, section == "CC") %>% 
  select(section, weight)

og_weight <- salamanders %>% 
  filter(year == 2017, section == "OG") %>% 
  select(section, weight)

# means
mean_cc <- mean(cc_weight$weight)
mean_og <- mean(og_weight$weight, na.rm = TRUE)

# exploratory data viz
ggplot() +
  geom_histogram(data = cc_weight, aes(x = weight),
                 fill = "red", 
                 bins = 50) +
  geom_histogram(data = og_weight, aes(x = weight),
                 fill = "blue",
                 bins = 50)

ggplot(data = cc_weight, aes(sample = weight))+
  geom_qq()
ggplot(data = og_weight, aes(sample = weight))+
  geom_qq()

# data don't seem to be normally distributed, so probably shouldn't use the t-test?

# t-test
weight_ttest <- t.test(cc_weight$weight, og_weight$weight)
weight_ttest

# Mann-Whitney U
weight_mwu <- wilcox.test(cc_weight$weight, og_weight$weight)
weight_mwu

# effect size
section_weight_es <- cohen.d(cc_weight$weight, og_weight$weight, na.rm = TRUE)
section_weight_es
```

#### 4. Salamander weight based on channel classification in 2017

```{r}
library(ggbeeswarm)
library(ggridges)

channel_weight <- salamanders %>% 
  filter(year == "2017",
         unittype %in% c("C", "P", "SC")) %>% 
  select(unittype, weight, year) %>% 
  na.omit() 

# Explore data by channel classification

channel_weight_summary <- channel_weight %>% 
  group_by(unittype) %>% 
  summarize(mean = mean(weight),
            median = median(weight),
            count = n()) 

# Labels to title facets

channel_labels <- c(C = "Cascade",
                    P = "Pool",
                    SC = "Side Channel")

# Violin/box plot

ggplot(channel_weight, aes(y = weight,
                           x = fct_reorder(unittype, weight, median))) +
  geom_violin(aes(color = unittype,
                  fill = unittype),
               alpha = 0.5,
               show.legend = FALSE) +
  geom_boxplot(aes(color = unittype),
               show.legend = FALSE,
               alpha = 0.8,
               width = 0.14) +
  scale_color_manual(values = c("steelblue4","darkslategray4", "royalblue3")) +
  scale_fill_manual(values = c("steelblue4", "darkslategray4", "royalblue3")) +
  theme_minimal() + 
  theme(panel.grid.minor = element_blank()) +
  labs(y = "Weight (g)",
       x = "Channel Classification") +
  coord_flip() +
  scale_x_discrete(labels = c("Cascade", "Pool", "Side Channel"))

```

```{r}

channel_weight_summary

```



### Summary

### References

**Gregory S. V. 2016.** Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702. Dataset accessed 11/30/2019.

**“Pacific Giant Salamander.” (n.d.).** Oregon Wild, oregonwild.org/wildlife/pacific-giant-salamander.

**Welsh, Hartwell H., Jr.; Ollivier, L.M. 1998.** Stream amphibians as indicators of ecosystem stress: a case study from California''s redwoods. Ecological Applications 8(4):1118-1132
